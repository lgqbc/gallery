<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'unsafe-inline' https://cdn.tailwindcss.com; img-src 'self' https:; style-src 'unsafe-inline' https://cdn.tailwindcss.com; connect-src 'self' https://api.github.com">
  <title>Gallery</title>
  <script src="https://cdn.tailwindcss.com"></script>

<!-- custom colors -->
  <script>tailwind.config={theme:{extend:{colors:{coal:"#111111"}}}};</script>

  <style>
    html, body {overflow-x: hidden;}
  </style>
</head>
<body class="bg-coal text-gray-400">

<div id="fullscreen" class="flex items-center justify-center h-screen relative">
  <div id="title" class="hidden absolute bottom-5 left-5 md:left-12 text-2xl"></div>
  <img id="image" class="rounded-lg 
    max-w-[100%] 2xl:max-w-[93%] max-h-[100%] 2xl:max-h-[93%] 
    object-contain" src="" alt="">
  <button id="gridBtn" class="absolute top-6 right-3 2xl:right-64 px-3 py-2 hover:text-white text-6xl opacity-50 z-10 scale-95">⋮⋮⋮</button>
  <button id="openPopup" class="absolute top-6 2xl:top-24 right-24 2xl:right-[16.2rem] px-3 py-2 hover:text-white text-6xl opacity-50 z-10 scale-110">▢</button>
  
  <div id="dotsBar" class="absolute bottom-32 sm:bottom-5 left-1/2 transform -translate-x-1/2 flex gap-3 z-[1000] scale-75 sm:scale-100"></div>
  
  <div id="prev" class="text-white opacity-25 hover:opacity-40 absolute left-2 2xl:left-[20rem] text-6xl cursor-pointer scale-100 lg:scale-150 z-50">⟨</div>
  <div id="next" class="text-white opacity-25 hover:opacity-40 absolute right-2 2xl:right-[20rem] text-6xl cursor-pointer scale-100 lg:scale-150 z-50">⟩</div>
    <!-- Clickable left half for previous -->
  <div id="prev-area" class="absolute top-0 left-0 bottom-36 sm:bottom-6 w-1/2 cursor-pointer -z-2"></div>
  <!-- Clickable right half for next -->
  <div id="next-area" class="absolute top-0 right-0 bottom-36 sm:bottom-6 w-1/2 cursor-pointer -z-2"></div>
  
</div>

  
<div id="grid" class="hidden bg-coal min-h-screen p-5 md:p-12">
   <button id="closeGrid" class="text-4xl sm:text-6xl absolute top-3 right-5 px-2 py-0 text-gray-300 bg-transparent rounded-full opacity-50 hover:opacity-70 z-10 scale-150">×</button>
  <div id="gridContainer" class="grid gap-2 md:gap-5 lg:gap-10 grid-cols-2 lg:grid-cols-3"></div>
</div>

<!-- Welcome popup (shows only if user hasn't closed it yet) -->
<div id="welcomePopup"
     class="fixed inset-0 bg-coal/90 filter saturate-10 flex items-center justify-center z-50 hidden text-sm sm:text-sm">
  <div class="opacity-50 bg-black text-gray-200 p-3 sm:p-6 rounded-xl max-w-[75%] xl:max-w-[25%] text-justify">
    <h2 class="text-xl text-semibold mb-2">hello.</h2>
    <p class="mb-2 sm:mb-4 italic">you found my gallery. how did you end up here?
      <br><br>all photos are unedited - as shot - on old digicams.</p>
    <p class="italic text-gray-600">bofu/2026</p>
    <p class="mb-1 italic text-gray-600 text-sm">contact: lukas.gilow@gmail.com</p>
    <br>
    <div class="w-full flex justify-center">
      <button id="closePopup"
              class="px-4 py-2 bg-black text-white rounded-lg hover:opacity-80">
        Continue
      </button>
    </div>
  </div>
</div>
  
<script>

// Show welcome popup only if user has NOT closed it before
    const popup = document.getElementById("welcomePopup");
    const closeBtn = document.getElementById("closePopup");
    const openBtn = document.getElementById("openPopup");
  
// Show popup on first visit (unless closed before)
    if (!localStorage.getItem("closedPopup")) {
      popup.classList.remove("hidden");
    }
  
// Close
    closeBtn.onclick = () => {
      popup.classList.add("hidden");
      localStorage.setItem("closedPopup", "true");
    };
  
// Re-open manually whenever the user wants
    openBtn.onclick = () => {
      popup.classList.remove("hidden");
    };
    
  let images = [];
  let current = 0;

  async function loadImages() {
    await new Promise(r => setTimeout(r, 500));
    try {
      const response = await fetch('https://api.github.com/repos/lgqbc/gallery/contents/images');
      const data = await response.json();
      images = data.filter(f => /\.(jpg|jpeg|png|gif|webp)$/i.test(f.name)).map(f => ({
        name: f.name.replace(/\.[^/.]+$/, ''),
        url: f.download_url
      }));
      render();
    } catch (e) {
      document.getElementById('title').textContent = 'Error loading images';
    }
  }

  function render() {
    const fs = document.getElementById('fullscreen');
    const g = document.getElementById('grid');

      if (fs.classList.contains('flex')) {
        const image = images[current];
        document.getElementById('image').src = image.url;
      
        const name = image.name;
        document.getElementById('title').textContent = name.startsWith("DSC") ? "" : name;
      
        document.getElementById('prev').style.display = current === 0 ? 'none' : 'block';
        document.getElementById('next').style.display = current === images.length - 1 ? 'none' : 'block';
      
// --- DOTS BAR ---
        document.getElementById('dotsBar').innerHTML = images.map((_, i) => {
          const isActive = i === current;
          return `
            <div class="relative cursor-pointer ${isActive ? '' : 'group'}" onclick="setCurrent(${i})">
              <div class="absolute inset-[-7px]"></div>
              <div class="w-2 h-2 bg-slate-300 rounded-full ${isActive ? 'opacity-[1]' : 'opacity-[0.25] group-hover:opacity-[.65]'}"></div>
            </div>
          `;
        }).join('');

      }

// image loading
    if (fs.classList.contains('flex')) {
      document.getElementById('image').src = images[current].url;
      document.getElementById('title').textContent = images[current].name;
      document.getElementById('prev').style.display = current === 0 ? 'none' : 'block';
      document.getElementById('next').style.display = current === images.length - 1 ? 'none' : 'block';
    } else {
      document.getElementById('gridContainer').innerHTML = images.map((img, i) => 
        `<div class="cursor-pointer overflow-hidden aspect-square" onclick="setCurrent(${i})"><img src="${img.url}" alt="${img.name}" class="w-full h-full object-cover"></div>`
      ).join('');
    }
  }

  function setCurrent(i) {
    current = i;
    document.getElementById('fullscreen').classList.remove('hidden');
    document.getElementById('fullscreen').classList.add('flex');
    document.getElementById('grid').classList.add('hidden');
    document.getElementById('gridBtn').textContent = '⋮⋮⋮';
    render();
  }

  document.getElementById("closeGrid").onclick = () => {
// hide grid
  document.getElementById("grid").classList.add("hidden");

// show fullscreen
  document.getElementById("fullscreen").classList.remove("hidden");
  document.getElementById("fullscreen").classList.add("flex");

// make sure the image updates correctly
  render();
  };

    
  document.getElementById('prev').addEventListener('click', () => { if (current > 0) { current--; render(); } });
  document.getElementById('next').addEventListener('click', () => { if (current < images.length - 1) { current++; render(); } });
  
  document.getElementById('prev-area').addEventListener('click', () => { if (current > 0) { current--; render(); } });
  document.getElementById('next-area').addEventListener('click', () => { if (current < images.length - 1) { current++; render(); } });
  
  document.getElementById('gridBtn').addEventListener('click', function() {
    const fs = document.getElementById('fullscreen');
    const g = document.getElementById('grid');
    if (g.classList.contains('hidden')) {
      fs.classList.add('hidden');
      fs.classList.remove('flex');
      g.classList.remove('hidden');
      this.textContent = '⋮⋮⋮';
      render();
    } else {
      fs.classList.remove('hidden');
      fs.classList.add('flex');
      g.classList.add('hidden');
      this.textContent = 'Grid';
    }
  });

  loadImages();
</script>

</body>
</html>
