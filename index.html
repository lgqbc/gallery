<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'unsafe-inline'; img-src 'self' https:; style-src 'unsafe-inline'; connect-src 'self' https://api.github.com">
  <title>Gallery</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white">

<div id="fullscreen" class="flex items-center justify-center h-screen relative">
  <div id="title" class="absolute top-5 left-5 md:left-12 text-2xl"></div>
  <img id="image" class="max-w-[90%] max-h-[90%] object-contain" src="" alt="">
  <div id="prev" class="absolute left-5 md:left-12 text-4xl cursor-pointer hover:opacity-70">&lt;</div>
  <div id="next" class="absolute right-5 md:right-12 text-4xl cursor-pointer hover:opacity-70">&gt;</div>
  <button id="gridBtn" class="absolute top-5 right-5 md:right-12 px-4 py-2 bg-gray-900 border border-gray-700 hover:bg-gray-800 text-sm">Grid</button>
</div>

<div id="grid" class="hidden bg-black min-h-screen p-5 md:p-12">
  <div id="gridContainer" class="grid gap-5 grid-cols-1 md:grid-cols-2 lg:grid-cols-3"></div>
</div>

<script>
  let images = [];
  let current = 0;

  async function loadImages() {
    await new Promise(r => setTimeout(r, 500));
    try {
      const response = await fetch('https://api.github.com/repos/lgqbc/gallery/contents/images');
      const data = await response.json();
      images = data.filter(f => /\.(jpg|jpeg|png|gif|webp)$/i.test(f.name)).map(f => ({
        name: f.name.replace(/\.[^/.]+$/, ''),
        url: f.download_url
      }));
      render();
    } catch (e) {
      document.getElementById('title').textContent = 'Error loading images';
    }
  }

  function render() {
    const fs = document.getElementById('fullscreen');
    const g = document.getElementById('grid');
    
    if (fs.classList.contains('flex')) {
      document.getElementById('image').src = images[current].url;
      document.getElementById('title').textContent = images[current].name;
      document.getElementById('prev').style.display = current === 0 ? 'none' : 'block';
      document.getElementById('next').style.display = current === images.length - 1 ? 'none' : 'block';
    } else {
      document.getElementById('gridContainer').innerHTML = images.map((img, i) => 
        `<div class="cursor-pointer overflow-hidden aspect-square" onclick="setCurrent(${i})"><img src="${img.url}" alt="${img.name}" class="w-full h-full object-cover"></div>`
      ).join('');
    }
  }

  function setCurrent(i) {
    current = i;
    document.getElementById('fullscreen').classList.remove('hidden');
    document.getElementById('fullscreen').classList.add('flex');
    document.getElementById('grid').classList.add('hidden');
    document.getElementById('gridBtn').textContent = 'Grid';
    render();
  }

  document.getElementById('prev').addEventListener('click', () => { if (current > 0) { current--; render(); } });
  document.getElementById('next').addEventListener('click', () => { if (current < images.length - 1) { current++; render(); } });
  
  document.getElementById('gridBtn').addEventListener('click', function() {
    const fs = document.getElementById('fullscreen');
    const g = document.getElementById('grid');
    if (g.classList.contains('hidden')) {
      fs.classList.add('hidden');
      fs.classList.remove('flex');
      g.classList.remove('hidden');
      this.textContent = 'View';
      render();
    } else {
      fs.classList.remove('hidden');
      fs.classList.add('flex');
      g.classList.add('hidden');
      this.textContent = 'Grid';
    }
  });

  loadImages();
</script>

</body>
</html>
