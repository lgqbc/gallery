<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'unsafe-inline' https://cdn.tailwindcss.com; img-src 'self' https:; style-src 'unsafe-inline' https://cdn.tailwindcss.com; connect-src 'self' https://api.github.com">
  <title>Gallery</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {overflow-x: hidden;}
  </style>
</head>
<body class="bg-black text-gray-400">

<div id="fullscreen" class="flex items-center justify-center h-screen relative">
  <div id="title" class="hidden absolute bottom-5 left-5 md:left-12 text-2xl"></div>
  <img id="image" class="
    max-w-[100%] 2xl:max-w-[93%] max-h-[100%] 2xl:max-h-[93%] 
    object-contain" src="" alt="">
  <button id="gridBtn" class="absolute top-6 right-3 2xl:right-64 px-3 py-2 hover:text-white text-6xl opacity-50 z-10">⋮⋮⋮</button>
  <div id="dotsBar" class="absolute bottom-32 sm:bottom-5 left-1/2 transform -translate-x-1/2 flex gap-2 z-10 scale-75 sm:scale-100"></div>

  <button id="openPopup" class="absolute top-24 right-3 2xl:right-64 px-3 py-2 hover:text-white text-6xl opacity-50 z-10">⌤</button>
  
  <div id="prev" class="text-white opacity-25 absolute left-2 2xl:left-64 text-6xl cursor-pointer scale-100 lg:scale-150">⟨</div>
  <div id="next" class="text-white opacity-25 absolute right-2 2xl:right-64 text-6xl cursor-pointer scale-100 lg:scale-150">⟩</div>

    <!-- Clickable left half for previous -->
  <div id="prev-area" class="absolute top-0 left-0 h-full w-1/2 cursor-pointer -z-2"></div>
  
  <!-- Clickable right half for next -->
  <div id="next-area" class="absolute top-0 right-0 h-full w-1/2 cursor-pointer -z-2"></div>
  
</div>

<div id="grid" class="hidden bg-black min-h-screen p-5 md:p-12">
   <button id="closeGrid" class="text-4xl sm:text-6xl absolute top-3 right-5 px-2 py-0 text-gray-300 bg-transparent rounded-full opacity:80 hover:opacity-50 z-10 scale-150">×</button>
  <div id="gridContainer" class="grid gap-2 md:gap-5 lg:gap-10 grid-cols-2 lg:grid-cols-3"></div>
</div>

<!-- Welcome popup (shows only if user hasn't closed it yet) -->
<div id="welcomePopup"
     class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 hidden">
  <div class="opacity-75 bg-black text-gray-200 p-3 sm:p-6 rounded-xl w-80 text-center">
    <h2 class="text-xl text-semibold mb-2">hello</h2>
    <p class="mb-1 sm:mb-2 italic">you found my gallery. 
    </br>all photos on here are unedited (as shot) on old digicams.</p>
    </br><p class="mb-1 italic text-gray-600 text-sm">contact: lukas.gilow@gmail.com</p>
    </br>
    <button id="closePopup"
            class="px-4 py-2 bg-gray-800 text-white rounded-lg hover:opacity-80">
      Continue
    </button>
  </div>
</div>

<script>

    // Show welcome popup only if user has NOT closed it before
    const popup = document.getElementById("welcomePopup");
    const closeBtn = document.getElementById("closePopup");
    const openBtn = document.getElementById("openPopup");
  
    // Show popup on first visit (unless closed before)
    if (!localStorage.getItem("closedPopup")) {
      popup.classList.remove("hidden");
    }
  
    // Close
    closeBtn.onclick = () => {
      popup.classList.add("hidden");
      localStorage.setItem("closedPopup", "true");
    };
  
    // Re-open manually whenever the user wants
    openBtn.onclick = () => {
      popup.classList.remove("hidden");
    };
    
  let images = [];
  let current = 0;

  async function loadImages() {
    await new Promise(r => setTimeout(r, 500));
    try {
      const response = await fetch('https://api.github.com/repos/lgqbc/gallery/contents/images');
      const data = await response.json();
      images = data.filter(f => /\.(jpg|jpeg|png|gif|webp)$/i.test(f.name)).map(f => ({
        name: f.name.replace(/\.[^/.]+$/, ''),
        url: f.download_url
      }));
      render();
    } catch (e) {
      document.getElementById('title').textContent = 'Error loading images';
    }
  }

  function render() {
    const fs = document.getElementById('fullscreen');
    const g = document.getElementById('grid');

      if (fs.classList.contains('flex')) {
        const image = images[current];
        document.getElementById('image').src = image.url;
      
        const name = image.name;
        document.getElementById('title').textContent = name.startsWith("DSC") ? "" : name;
      
        document.getElementById('prev').style.display = current === 0 ? 'none' : 'block';
        document.getElementById('next').style.display = current === images.length - 1 ? 'none' : 'block';
      
        // --- DOTS BAR ---
        document.getElementById('dotsBar').innerHTML = images.map((_, i) =>
          `<div class="w-2 h-2 opacity-50 rounded-full ${i === current ? 'bg-white' : 'bg-gray-500'} cursor-pointer"
               onclick="setCurrent(${i})"></div>`
        ).join('');
      }
    
    if (fs.classList.contains('flex')) {
      document.getElementById('image').src = images[current].url;
      document.getElementById('title').textContent = images[current].name;
      document.getElementById('prev').style.display = current === 0 ? 'none' : 'block';
      document.getElementById('next').style.display = current === images.length - 1 ? 'none' : 'block';
    } else {
      document.getElementById('gridContainer').innerHTML = images.map((img, i) => 
        `<div class="cursor-pointer overflow-hidden aspect-square" onclick="setCurrent(${i})"><img src="${img.url}" alt="${img.name}" class="w-full h-full object-cover"></div>`
      ).join('');
    }
  }

  function setCurrent(i) {
    current = i;
    document.getElementById('fullscreen').classList.remove('hidden');
    document.getElementById('fullscreen').classList.add('flex');
    document.getElementById('grid').classList.add('hidden');
    document.getElementById('gridBtn').textContent = '⋮⋮⋮';
    render();
  }

  document.getElementById("closeGrid").onclick = () => {
  // hide grid
  document.getElementById("grid").classList.add("hidden");

  // show fullscreen
  document.getElementById("fullscreen").classList.remove("hidden");
  document.getElementById("fullscreen").classList.add("flex");

  // make sure the image updates correctly
  render();
  };

  
  document.getElementById('prev-area').addEventListener('click', () => { if (current > 0) { current--; render(); } });
  document.getElementById('next-area').addEventListener('click', () => { if (current < images.length - 1) { current++; render(); } });
  
  document.getElementById('gridBtn').addEventListener('click', function() {
    const fs = document.getElementById('fullscreen');
    const g = document.getElementById('grid');
    if (g.classList.contains('hidden')) {
      fs.classList.add('hidden');
      fs.classList.remove('flex');
      g.classList.remove('hidden');
      this.textContent = '⋮⋮⋮';
      render();
    } else {
      fs.classList.remove('hidden');
      fs.classList.add('flex');
      g.classList.add('hidden');
      this.textContent = 'Grid';
    }
  });

  loadImages();
</script>

</body>
</html>
